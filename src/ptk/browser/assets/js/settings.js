/* Author: Denis Podgurskii */
import { ptk_controller_settings } from "../../../controller/settings.js"
const controller = new ptk_controller_settings()

jQuery(function () {
    $('#mainMenu a.item').each(function (i, obj) {
        if (window.location.pathname.indexOf($(obj).attr('href')) > 0)
            $(obj).addClass('active').siblings().removeClass('active')
    });

    //Submenu all pages
    $('.ui.menu a.item').on('click', function () {
        $(this).addClass('active').siblings().removeClass('active')
        let forItem = $(this).attr('forItem')
        $('.ui.menu a.item').each(function (i, obj) {
            let f = $(obj).attr('forItem')
            if (f != forItem) $('#' + f).hide()
        })
        $('#' + forItem).fadeIn("slow")
    })

    $('#settings_save').on('click', function () {

        let $form = $('#main_form'), values = $form.form('get values')
        Object.keys(values).map((k) => { if (values[k] === 'on') values[k] = true })
        controller.save('main', values)

        $form = $('#tabs_form'), values = $form.form('get values')
        Object.keys(values).map((k) => { if (values[k] === 'on') values[k] = true })
        controller.save('tabs', values)


        $form = $('#integration_form'), values = $form.form('get values')
        Object.keys(values).map((k) => { if (values[k] === 'on') values[k] = true })

        controller.save('integration.default.enable', values['default'])
        controller.save('integration.rapid7.enable', values['rapid7'])

        $form = $('#recorder_form'), values = $form.form('get values')
        Object.keys(values).map((k) => { if (values[k] === 'on') values[k] = true })

        controller.save('recorder.set_window_size', values['set_window_size'])
        controller.save('recorder.window_height', values['window_height'])
        controller.save('recorder.window_width', values['window_width'])

        controller.restore().then(function (s) {
            controller.on_updated_settings(s)
        })
        

        $(".modal").fadeIn("slow").delay(2000).fadeOut()

    })

    $('#settings_reset').on('click', function () {
        controller.reset().then(function (s) {
            $(document).trigger("init_forms", s)
            $(".modal").fadeIn("slow").delay(2000).fadeOut()
        })
    })
    controller.restore().then(function (s) {
        $(document).trigger("init_forms", s)
    })
})


$(document).on("init_forms", function (e, s) {
    $('#main_form').form('set values', s.main)
    $('#tabs_form').form('set values', s.tabs)
    $('#integration_form').form('set values', { 'default': s.integration?.default?.enable, 'rapid7': s.integration?.rapid7?.enable })
    $('#recorder_form').form('set values', s.recorder)
})
