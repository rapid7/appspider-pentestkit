/* Author: Denis Podgurskii */
'use strict';

var bgProxy = chrome.extension.getBackgroundPage().BackgroundProxy;

chrome.tabs.getCurrent(function(tab) {
    if (typeof tab != 'undefined') {
        bgProxy.excludeTab(tab.id);
        bgProxy.Logger.log("exclude tab " + tab.id);
    }
});


$(document).ready(function() {

    //Main menu
    $('#mainMenu').append(
        '<a class="item" href="index.html">Dashboard</a>' +
        '<a class="item" href="requestbuilder.html">Request Builder</a>' +
        '<a class="item" href="recorder.html">Recorder</a>' +
        '<div class="ui dropdown item right floating">More' +
        '   <div class="ui dropdown icon"></div>' +
        '   <div class="menu" style="margin-top: 0px !important;">' +
        '       <a class="item disabled" href="headers.html">Headers manager(v.2)</a>' +
        '       <a class="item disabled" href="reqexbuilder.html">Regex Builder (v.2)</a>' +
        '       <div class="ui fitted divider"></div>' +
        '       <a class="item" href="#" id="opennewwindow">Open in new window</a>' +
        '       <a class="item" href="#" id="opensettings">Settings</a>' +
        '       <div class="ui fitted divider"></div>' +
        '       <div class="header"></div>' +
        '       <a class="item" target="_blank" href="https://github.com/rapid7/appspider-pentestkit">Github</a>' +
        '       <a class="item disabled" href="#">Support</a>' +
        '   </div>' +
        '</div>'
    );

    $('#mainMenu a.item').each(function(i, obj) {
        if (window.location.pathname.indexOf($(obj).attr('href')) > 0)
            $(obj).addClass('active').siblings().removeClass('active');
    });

    //Submenu all pages
    $('.ui.menu a.item').on('click', function() {
        $(this).addClass('active').siblings().removeClass('active');
        var forItem = $(this).attr('forItem');
        $('.ui.menu a.item').each(function(i, obj) {
            var f = $(obj).attr('forItem');
            if (f != forItem) {
                $('#' + f).hide("");
            }
        });
        $('#' + forItem).show("");
    });

    //Settings page
    $('#opensettings').click(function() {
        chrome.runtime.openOptionsPage(function() {});
        return false;
    });

    //New window
    $('#opennewwindow').click(function() {
        bgProxy.BrowserActions.openInNewWindow();
        window.close();
        return false;
    });

    //Semantic UI 
    $('.ui.dropdown').dropdown({ on: 'click' });
    $('.ui.checkbox').checkbox();
    $('.dropdown.allowAdditions')
        .dropdown({
            allowAdditions: true
        });
});