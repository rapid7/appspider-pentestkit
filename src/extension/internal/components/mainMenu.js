import React, {
    useEffect,
    useRef,
    useState,
} from 'react';
import styled from 'styled-components';

import {
    TAB_SIZES,
    TAB_TYPES,
    Tabs,
    TabList,
    Tab,
    TabSlider,
    TabBody,
} from 'rapid7-ui';
import Rapid7Logo from 'rapid7-product-logos/dev/img/Rapid7_logo.svg';

import Macro from '../macro/macro';

const StyledTabHeader = styled.div`
  .tab-header .tab-header--left-align {
    display: flex;
  }
  
  img {
    height: 20px;
  }
`;

const StyledTabBody = styled.div`
  .tab-body {
      padding: 5px !important;
  }
`;

const onTabItemsChange = (tabRef, setSliderStyles) => {
    const {
        offsetLeft,
        offsetWidth,
    } = tabRef.current;

    setSliderStyles({
        left: offsetLeft,
        width: offsetWidth,
    });
};

const onTabUpdated = (tabRef, setSliderStyles) => {
    onTabItemsChange(tabRef, setSliderStyles);
};

const getTabBodyContent = () => {
    return (
        <Macro/>
    );
};

const MainMenu = () => {
    const tabRef = useRef(null);
    const [sliderStyles, setSliderStyles] = useState({
        left: 0, right: 0,
    });
    const [selectedTab, setSelectedTab] = useState(0);

    const onTabClicked = index => () => {
        setSelectedTab(index);
    };

    // When selected tab has changed then update the slider styles
    useEffect(() => {
        onTabUpdated(tabRef, setSliderStyles);
    }, [selectedTab]);

    return (
        <>
            <Tabs tabType={TAB_TYPES.TABS} tabSize={TAB_SIZES.MEDIUM}>
                <StyledTabHeader>
                    <TabList
                        align="left"
                    >
                        <img src={Rapid7Logo} alt="Rapid7 Logo"/>
                        <Tab
                            title="Macro"
                            onClick={onTabClicked(0)}
                            active={selectedTab === 0}
                            tabLinkRef={selectedTab === 0 ? tabRef : null}
                        />
                        <Tab
                            title="Traffic"
                            onClick={onTabClicked(1)}
                            active={selectedTab === 1}
                            tabLinkRef={selectedTab === 1 ? tabRef : null}
                        />
                        <Tab
                            title="Third"
                            onClick={onTabClicked(2)}
                            active={selectedTab === 2}
                            tabLinkRef={selectedTab === 2 ? tabRef : null}
                        />
                        <TabSlider style={sliderStyles}/>
                    </TabList>
                </StyledTabHeader>
                <StyledTabBody>
                    <TabBody>
                        {getTabBodyContent()}
                    </TabBody>
                </StyledTabBody>
            </Tabs>
        </>
    );
};

MainMenu.propTypes = {};

export default MainMenu;
