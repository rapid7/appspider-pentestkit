<!DOCTYPE HTML>
<html>

<head>
    <title>Penetration Testing Kit - How to</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <link rel="stylesheet" href="../assets/css/main.css" />
    <link rel="shortcut icon" href="../images/icon.png" type="image/x-icon">
    <script>


        let extensionId = null

        document.addEventListener("ptk_extension_event", function (data) {
            // success: true / false,
            // result: result,
            // error: error

            //init_recording
            //start_recording
            //stop_recording
            //export_recording
            //reset_recording

            if (data.detail?.success) {
                document.getElementById('export').value = data.detail.event + '\r\n-------------\r\n' + data.detail.result
            } else {
                document.getElementById('export').value = data.detail.event + '\r\n-------------\r\n' + data.detail.error
            }

        })

        function initExtension() {
            window.postMessage({
                channel: 'ptk_messages_channel',
                command: 'init_recording'
            }, '*')
        }



        function startRecording(url) {
            window.postMessage({
                channel: 'ptk_messages_channel',
                command: 'start_recording',
                params: {
                    start_url: document.getElementById('startUrl').value,
                    clean_cookie: false
                }
            }, '*')
        }

        function stopRecording() {
            window.postMessage({
                channel: 'ptk_messages_channel',
                command: 'stop_recording'
            }, '*')
        }


        function resetRecording() {
            window.postMessage({
                channel: 'ptk_messages_channel',
                command: 'reset_recording'
            }, '*')
        }


        function exportRecording() {
            document.getElementById('export').value = "";
            window.postMessage({
                channel: 'ptk_messages_channel',
                command: 'export_recording',
                params: {
                    element: 'export', // element id
                    settings: {
                        format: "appspider", // [xml, har]
                        min_duration: 3000,
                        element_path: "id", //[id, fullpath]
                        event_type: "javascript", //[javascript, driverclick, onclick ]
                    }
                }
            }, '*')
        }


        function checkMacro() {
            var parser = new DOMParser();
            var text = document.getElementById('export').value;
            var xmlDoc = parser.parseFromString(text, "text/xml");

            if (xmlDoc.getElementsByTagName("parsererror").length > 0) {
                //checkErrorXML(xmlDoc.getElementsByTagName("parsererror")[0]);
                alert(xt)
            }
            else {
                alert("No errors found");
            }
        }
    </script>

</head>

<body class="is-preload">
    <!-- Header -->
    <header id="header">
        <a class="logo" href="../index.html">Penetration Testing Kit - Home</a>
        <nav>
            <a href="#menu">Menu</a>
        </nav>
    </header>
    <!-- Nav -->
    <nav id="menu" class="child">
    </nav>
    <!-- Heading -->
    <div id="heading">
    </div>
    <!-- Main -->
    <section id="main" class="wrapper">
        <div class="inner">
            <a href="../howto.html" style="float: left;position: relative;top: -25px;">
                <h4>Howto</h4>
            </a>
            <a href="../index.html" style="float: right;position: relative;top: -25px;">
                <h4>Home</h4>
            </a>
            <a id="dashboard"></a>
            <div class="content">
                <h3>Integration</h3>
                <p>In order to establish a connection with the PTK use window.postMessage mechanism - see on this <a
                        href="https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage">link</a> </p>
                <pre><code>window.postMessage({
        channel: 'ptk_messages_channel',
        command: 'SEE SUPPORTED COMMANDS'
    }, '*')</code></pre>
                <hr />
                <h4>Supported commands:</h4>
                <ul>
                    <li>init_recording</li>
                    <li>start_recording</li>
                    <li>stop_recording</li>
                    <li>export_recording</li>
                    <li>reset_recording</li>
                </ul>
                <p>To listen to the PTK responses use <a
                        href="https://developer.mozilla.org/en-US/docs/Web/API/CustomEvent"
                        target="_blank">CustomEvent</a></p>
                <p>Event detail value has the following structure:
        <pre><code>detail{
        event: SEE SUPPORTED COMMANDS,
        success: true | false,
        result | error: data
    }
</code></pre>
                </p>

                <pre><code>document.addEventListener("ptk_extension_event", function (data) {
        if (data.detail?.success) {
            document.getElementById('export').value = data.detail.event + '\r\n-------------\r\n' + data.detail.result
        } else {
            document.getElementById('export').value = data.detail.event + '\r\n-------------\r\n' + data.detail.error
        }

    })</code></pre>
                <hr />
                <table style="border: solid 1px #ccc">
                    <tr>
                        <td>Type URL:</td>
                        <td colspan="4"><input type="text" id="startUrl" value='http://webscantest.com' /></textarea>
                        </td>
                    </tr>
                    <tr>
                        <td><input type="button" onclick="initExtension();" value="Init command"></td>
                        <td><input type="button" onclick="startRecording();" id="recordAppSpiderMacro"
                                value="Start recording"></td>
                        <td><input type="button" onclick="stopRecording();" value="Stop recording"></td>
                        <td><input type="button" onclick="exportRecording();" value="Export"></td>
                        <td><input type="button" onclick="resetRecording();" value="Reset" style="width: 100%;"></td>

                    </tr>

                    <tr>
                        <td colspan="5"><textarea id="export" rows="30" cols="80"></textarea></td>
                    </tr>


                </table>
            </div>
        </div>
    </section>
    <!-- Footer -->
    <footer id="footer">
    </footer>
    <!-- Scripts -->
    <script src="../assets/js/jquery.min.js"></script>
    <script src="../assets/js/browser.min.js"></script>
    <script src="../assets/js/breakpoints.min.js"></script>
    <script src="../assets/js/util.js"></script>
    <script src="../assets/js/main.js"></script>
</body>

</html>