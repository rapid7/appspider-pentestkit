#!/bin/bash

npm update

npm install webextension-polyfill
npm install fomantic-ui
npm install jquery
npm install datatables.net
npm install codemirror-minified
npm install wappalyzer-core
npm install mermaid
npm install perf-cascade
npm install js-yaml
npm install pentestkit

npm audit fix

mkdir -p src/packages/browser-polyfill
cp ./node_modules/webextension-polyfill/dist/browser-polyfill.min.js src/packages/browser-polyfill
cp ./node_modules/webextension-polyfill/dist/browser-polyfill.min.js.map src/packages/browser-polyfill


mkdir -p src/packages/wappalyzer
cp ./node_modules/wappalyzer-core/wappalyzer.js src/packages/wappalyzer
sed -i '' "s/const Wappalyzer/export const Wappalyzer/" src/packages/wappalyzer/wappalyzer.js
curl  -o src/packages/wappalyzer/technologies.json "https://raw.githubusercontent.com/AliasIO/wappalyzer/master/src/technologies.json"


mkdir -p src/packages/jquery
cp ./node_modules/jquery/dist/jquery.min.js src/packages/jquery/
cp ./node_modules/jquery/dist/jquery.min.map src/packages/jquery/
cp ./node_modules/datatables.net/js/jquery.dataTables.min.js src/packages/jquery/


mkdir -p src/packages/semantic-ui
cp ./node_modules/fomantic-ui/dist/semantic.min.js src/packages/semantic-ui/
cp ./node_modules/fomantic-ui/dist/semantic.min.css src/packages/semantic-ui/
mkdir -p src/packages/semantic-ui/themes/default/
cp -r ./node_modules/fomantic-ui/dist/themes/default/ src/packages/semantic-ui/themes/default/

mkdir -p src/packages/codemirror
cp ./node_modules/codemirror-minified/lib/codemirror.js src/packages/codemirror/
cp ./node_modules/codemirror-minified/lib/codemirror.css src/packages/codemirror/
mkdir -p src/packages/codemirror/addon/fold
cp -r ./node_modules/codemirror-minified/addon/fold/ src/packages/codemirror/addon/fold/
mkdir -p src/packages/codemirror/mode/xml
cp -r ./node_modules/codemirror-minified/mode/xml/ src/packages/codemirror/mode/xml/

mkdir -p src/packages/mermaid
cp ./node_modules/mermaid/dist/mermaid.min.js src/packages/mermaid/

mkdir -p src/packages/perf-cascade
cp ./node_modules/perf-cascade/dist/perf-cascade.css src/packages/perf-cascade/
cp ./node_modules/perf-cascade/dist/perf-cascade-file-reader.min.js src/packages/perf-cascade/
cp ./node_modules/perf-cascade/dist/perf-cascade.min.js src/packages/perf-cascade/

mkdir -p src/packages/swagger-editor
cp ./node_modules/swagger-editor/dist/swagger-editor.css src/packages/swagger-editor/
cp ./node_modules/swagger-editor/dist/swagger-editor-bundle.js src/packages/swagger-editor/
curl  -o src/packages/swagger-editor/swagger-editor-standalone-preset.js -L "https://raw.githubusercontent.com/swagger-api/swagger-editor/master/dist/swagger-editor-standalone-preset.js"

mkdir -p src/packages/js-yaml
cp ./node_modules/js-yaml/dist/js-yaml.min.js src/packages/js-yaml/

mkdir -p src/packages/pentestkit
cp -r ./node_modules/pentestkit/ src/packages/pentestkit/


npm install archiver
#npm run build


